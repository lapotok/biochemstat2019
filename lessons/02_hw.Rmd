---
title: "Домашнее задание №2"
output: 
    html_document:
        toc: false
editor_options: 
  chunk_output_type: console
---

Для начала надо загрузить необходимые библиотеки.

```{r}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(magrittr))
library(rio)
library(ggpubr)
```

Для всех заданий нужно предоставить код решений + какие-то комментарии (если в задании был задан какой-то вопрос - то ответ на него). Свой ответ вы можете составить в любом удобном Вам виде (например, в виде документа MS Word). Однако, рекоммендую Вам ознакомиться с R markdown и отправить мне решение в формате Rmd.


1. Скачайте [данный файл](https://github.com/lapotok/biochemstat2019/blob/master/data/bact_cells_bad.xlsx?raw=true). Импортируйте его в `R`. Посмотрите, все ли прошло успешно. Если надо как-то модифицировать данные для последующей обработки - сделайте это (типы переменных, названия, опечатки и т.п.).

```{r echo=F, eval=F}
library(rio)
library(tidyverse)
library(magrittr)
library(ggpubr)
tmp = tempfile()
download.file("https://github.com/lapotok/biochem_statistics/blob/master/2018/lesson3/bact_cells_bad.xlsx?raw=true", tmp) 
bact = import(tmp, format = "xlsx")
bact %>% 
    set_colnames(c("n", "induced", "OD_start", "OD_end")) %>% 
    mutate(OD_end = str_replace(OD_end, ",", ".") %>% as.numeric()) %>%
    mutate(OD_end = ifelse(OD_end > 700, OD_end/1000, OD_end)) %>% 
    mutate(OD_end = ifelse(OD_end < .600, OD_end*10, OD_end)) %>% 
    ggboxplot("induced", "OD_end", add="jitter")
```

2. Не все файлы удобны для открывания - например, в Excel их нужно долго и упорно импортировать. Попробуем на примере файла, который выдает ридер для плашек для ELISA.

```
LABSYSTEMS GENESIS V3.05   Results   Wednesday, 09 January 2019   17:29
Raw data filename     : C:\genlite\protocol\09JAN19W.001
Processed by Protocol : c:\genlite\protocol\450.prt
Plate layout file     : c:\genlite\protocol\450.plt
Reading type          : Single Wavelength, One Reading
Instrument version    : MULTISKAN EX    PRIMARY EIA V. 2.3          
Filter 1              : 450nm
Lag time              : 00:00:00
Mix                   : NO

Raw data values (calculated):
   1      2      3      4      5      6      7      8      9      10     11     12     
A  3.021  2.942  2.961  2.980  2.335  1.102  0.482  0.273  0.140  0.102  0.096  0.105 
B  3.387  3.739  3.062  3.438  2.234  1.215  0.583  0.278  0.200  0.163  0.179  0.219 
C  3.137  2.953  2.924  2.939  2.366  1.266  0.579  0.276  0.209  0.130  0.125  0.108 
D  0.038  0.035  0.034  0.033  0.033  0.032  0.034  0.030  0.046  0.032  0.033  0.031 
E  0.035  0.031  0.035  0.034  0.034  0.033  0.044  0.046  0.046  0.037  0.047  0.036 
F  0.035  0.032  0.034  0.039  0.036  0.033  0.032  0.032  0.034  0.033  0.034  0.033 
G  0.032  0.033  0.035  0.035  0.038  0.033  0.035  0.033  0.036  0.035  0.037  0.034 
H  0.044  0.047  0.045  0.043  0.045  0.043  0.034  0.036  0.035  0.032  0.034  0.032 
```

Скачать такой файл можно [тут](https://github.com/lapotok/biochemstat2019/blob/master/data/plate_raw_data/09Jan19P.001?raw=true). Далее Вам в дополнительных аргументах к файлу надо указать вспомогательную информацию, чтобы пропустить "шапку" файла и дать программе понять, что нужно воспринимать данный файл как файл, где значения разделены табуляцией. На самом деле, команда `import` является интерфейсом к множеству специализированных команд для импорта различных типов файлов (почитайте справку к ней, а также к указанным в ней командам для импорта excel, comma-separated data, tab-separated data). В этой справке вы узнаете о дополнительных аргументах этой функции. Я привожу наиболее важные из них.

+ `format` - формат файла (если не ясно из расширения файла, как в "file.csv")
+ `skip` - сколько строк надо пропустить сначала (шапка файла со служебной инфой)
+ `sheet` - какой лист Excel импортировать
+ `header` - надо ли пытаться импортировать названия колонок из значений
+ `sep` - разделитель между значениями
+ `dec` - десятичный разделитель (3.14 или 3,14)

```{r eval = F}
# открываем файл
d = import("path/to/file/09Jan19P.001", ...)
d %>%  str() # проверяем, все ли так
```

3. Перейдем, наконец, к делу - откроем [данные](https://github.com/lapotok/biochemstat2019/blob/master/data/protein_stability.xlsx?raw=true) и визуально ответим на вопрос, есть ли различия между группами.

```{r eval = F}
d = import("path/to/file/protein_stability.xls")

# чтобы удобнее работать с названиями групп, их стоит сделать факторами
d = 
    d %>% 
    mutate(Sample = as.factor(Sample))
```

Данный файл содержит измерения иммунохимической активности белка после хранения в течение месяца при разных температурах. Нам интересно, влияет ли температура на активность белка и какую взять температуру, чтобы минимизировать деградацию. Данные приведены в абсолютных единицах активности, но удобнее было бы их перевести в проценты от средней активности в контрольной пробе (-70).

Для получения визуального ответа на вопрос задания постройте boxplot и на него наложите экспериментальные точки с доверительными интервалами. Также можете почитать про то, как в `R` делается ANOVA (команды `anova` и `lm`), а также использовать различные тесты для попарного сравнения групп (на следующем занятии мы будем говорить про `t.test`, `wilcoxon.test` и про множественные сравнения).